<launch>
  <!-- 测试配置 -->
  <arg name="trajectory_type" default="figure_eight"
       doc="Trajectory type: figure_eight, circle, straight, square, sine_wave"/>
  <arg name="simulation_mode" default="pure_kinematic"
       doc="Simulation mode: pure_kinematic, mujoco"/>
  <arg name="enable_visualization" default="true"/>
  <arg name="enable_metrics" default="true"/>
  <arg name="duration" default="60.0" doc="Test duration in seconds (0 for infinite)"/>

  <!-- 启动 mpccfollower 控制器 -->
  <node pkg="local_planner" type="mpccfollower" name="mpccfollower" output="screen">
    <rosparam command="load" file="$(find local_planner)/config/mpccfollower.yaml" />
  </node>

  <!-- 启动测试框架 -->
  <node pkg="local_planner" type="mpcc_test_framework.py" name="mpcc_test_framework"
        output="screen" required="true">
    <param name="trajectory_type" value="$(arg trajectory_type)"/>
    <param name="simulation_mode" value="$(arg simulation_mode)"/>
    <param name="enable_visualization" value="$(arg enable_visualization)"/>
    <param name="enable_metrics" value="$(arg enable_metrics)"/>
    <param name="duration" value="$(arg duration)" if="$(eval arg('duration') > 0)"/>

    <!-- 测试框架参数 -->
    <param name="rate" value="30.0"/>
    <param name="path_hz" value="5.0"/>
    <param name="track_scale" value="2.0"/>
    <param name="track_points" value="200"/>
    <param name="odom_topic" value="/localization"/>
    <param name="path_topic" value="/local_path"/>
    <param name="cmd_topic" value="/cmd_vel"/>
    <param name="pred_topic" value="/mpcc_pred_path"/>
  </node>

  <!-- 预测轨迹可视化 -->
  <node if="$(arg enable_visualization)" pkg="local_planner" type="mpcc_pred_visualizer.py"
        name="mpcc_pred_visualizer" output="screen">
    <param name="pred_topic" value="/mpcc_pred_path"/>
    <param name="odom_topic" value="/localization"/>
    <param name="marker_topic" value="/mpcc_pred_marker"/>
  </node>

  <!-- 可选：启动 RViz 可视化 -->
  <arg name="rviz" default="false"/>
  <node if="$(arg rviz)" pkg="rviz" type="rviz" name="rviz"
        args="-d $(find local_planner)/rviz/mpcc_test.rviz"/>

</launch>
